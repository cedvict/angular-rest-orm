/**
 * Angular ORM for HTTP REST APIs
 * @version angular-rest-orm - v0.4.4 - 2014-11-10
 * @link https://github.com/panta/angular-rest-orm
 * @author Marco Pantaleoni <marco.pantaleoni@gmail.com>
 *
 * Copyright (c) 2014 Marco Pantaleoni <marco.pantaleoni@gmail.com>
 * Licensed under the MIT License, http://opensource.org/licenses/MIT
 */
var __hasProp={}.hasOwnProperty,__slice=[].slice,__extends=function(a,b){function c(){this.constructor=a}for(var d in b)__hasProp.call(b,d)&&(a[d]=b[d]);return c.prototype=b.prototype,a.prototype=new c,a.__super__=b.prototype,a};angular.module("restOrm",[]).factory("Resource",["$http","$q","$rootScope",function(a,b,c){var d,e,f,g,h,i,j;return f=function(a){var b;if(null==a)return!0;if(a.length>0)return!1;if(0===a.length)return!0;for(b in a)if(__hasProp.call(a,b))return!1;return!0},h=function(a,b){return a.slice(0,b.length)===b},e=function(a,b){return""===b||a.slice(-b.length)===b},g=function(a){return null==a?!1:angular.isUndefined(a)||null===a?!1:angular.isObject(a)||angular.isArray(a)?!1:!0},j=function(){var a,b,c,d,f,g,i,j,k,l,m,n,o;if(c=1<=arguments.length?__slice.call(arguments,0):[],g=function(a){return a.replace(/[\/]+/g,"/").replace(/\/\?/g,"?").replace(/\/\#/g,"#").replace(/\:\//g,"://")},k=[],c&&c.length>0){for(j=0;j<c.length&&!c[j];)++j;j&&(c=c.slice(j))}for(f=null,l=0,n=c.length;n>l;l++)if(b=c[l],null!=b&&b)for(f=b,a=(""+b).split("/"),d=m=0,o=a.length;o>=0?o>m:m>o;d=o>=0?++m:--m)if(".."===a[d])k.pop();else{if("."===a[d]||""===a[d])continue;k.push(a[d])}return i=g(k.join("/")),c&&c.length>=1&&(b=""+c[0],h(b,"//")?i="//"+i:h(b,"/")&&(i="/"+i),f=""+f,e(f,"/")&&!e(i,"/")&&(i+="/")),i},i=function(){return encodeURI(j.apply(null,arguments))},d=function(){function d(a,b){null==a&&(a=null),null==b&&(b={}),this.$meta={persisted:!1,async:{direct:{deferred:null,resolved:!0},m2o:{deferred:null,resolved:!0},m2m:{deferred:null,resolved:!0}}},angular.extend(this.$meta,b),this.$id=null,this._fromObject(a||{}),this.$promise=null,this.$promiseDirect=null,this._setupPromises(),this._fetchRelations(),"function"==typeof this.$initialize&&this.$initialize.apply(this,arguments)}return d.urlPrefix="",d.urlEndpoint="",d.idField="id",d.fields={},d.defaults={},d.headers={},d.prepareRequest=null,d.transformResponse=null,d.postResponse=null,d.Reference="reference",d.ManyToMany="many2many",d.include=function(a){var b,c,d;if(!a)throw new Error("include(obj) requires obj");for(b in a)c=a[b],"included"!==b&&"extended"!==b&&(this.prototype[b]=c);return null!=(d=a.included)&&d.apply(this),this},d.extend=function(a){var b,c,d;if(!a)throw new Error("extend(obj) requires obj");for(b in a)c=a[b],"included"!==b&&"extended"!==b&&(this[b]=c);return null!=(d=a.extended)&&d.apply(this),this},d.Subclass=function(a,b){var c;return c=function(a){function b(){return b.__super__.constructor.apply(this,arguments)}return __extends(b,a),b}(this),a&&c.include(a),b&&c.extend(b),c.prototype.$super=function(a){return this.constructor.__super__[a]},c},d.Create=function(a,b){var c;return null==a&&(a=null),null==b&&(b={}),a=a||this.defaults,c=new this(a,{persisted:!1}),c.$save(b),c},d.Get=function(b,c){var d,e,f;return null==c&&(c={}),d=new this,f=i(this._GetURLBase(),b),d._setupPromises(),e=this._PrepareRequest({id:b,opts:c,what:"Get",method:"GET",url:f,headers:this._BuildHeaders("Get","GET",null),params:c.params||{},data:c.data||{},item:d}),a({method:e.method,url:e.url,headers:e.headers,params:e.params,data:e.data}).then(function(a){return function(b){var c;return c=a._TransformResponse(e,b),d._fromRemote(c.data),a._PostResponse(c)}}(this)),d},d.All=function(b){var c,d,e;return null==b&&(b={}),c=this._MakeCollection(),e=i(this._GetURLBase()),d=this._PrepareRequest({opts:b,what:"All",method:"GET",url:e,headers:this._BuildHeaders("All","GET",null),params:b.params||{},data:b.data||{},collection:c}),a({method:d.method,url:d.url,headers:d.headers,params:d.params,data:d.data}).then(function(a){return function(b){var e,f,g,h,i;for(e=a._TransformResponse(d,b),i=e.data,g=0,h=i.length;h>g;g++)f=i[g],c.push(a._MakeInstanceFromRemote(f));return a._PostResponse(e),c.$finalize()}}(this),function(a){return function(b){var e;return e=a._TransformResponse(d,b),a._PostResponse(e),c.$finalize(!1)}}(this)),c},d.Search=function(b,c,d){var e,f,g;return null==d&&(d={}),e=this._MakeCollection(),g=i(this._GetURLBase(),"search",b,c),f=this._PrepareRequest({field:b,value:c,opts:d,what:"Search",method:"GET",url:g,headers:this._BuildHeaders("Search","GET",null),params:d.params||{},data:d.data||{},collection:e}),a({method:f.method,url:f.url,headers:f.headers,params:f.params,data:f.data}).then(function(a){return function(b){var c,d,g,h,i;for(c=a._TransformResponse(f,b),i=c.data,g=0,h=i.length;h>g;g++)d=i[g],e.push(a._MakeInstanceFromRemote(d));return a._PostResponse(c),e.$finalize()}}(this),function(a){return function(b){var c;return c=a._TransformResponse(f,b),a._PostResponse(c),e.$finalize(!1)}}(this)),e},d.prototype.$save=function(b){var c,d,e,f;return null==b&&(b={}),c=this._toRemoteObject(),this.$meta.persisted&&null!=this.$id?(d="PUT",f=i(this._getURLBase(),this.$id)):(d="POST",this.constructor.idField in c&&delete c[this.constructor.idField],f=i(this._getURLBase())),this._setupPromises(),e=this._prepareRequest({opts:b,what:"$save",method:d,url:f,headers:this._buildHeaders("$save",d),params:b.params||{},data:c,cache:!1,item:this}),a({method:e.method,url:e.url,data:e.data,cache:e.cache,headers:e.headers,params:e.params}).then(function(a){return function(b){var c;return c=a._transformResponse(e,b),a._fromRemote(c.data),a._postResponse(c)}}(this)),this},d._MakeCollection=function(){var a;return a=[],a.$useApplyAsync=!1,a.$meta={model:this,async:{direct:{deferred:b.defer(),resolved:!1},complete:{deferred:b.defer(),resolved:!1}}},a.$error=!1,a.$promise=a.$meta.async.complete.deferred.promise,a.$promiseDirect=a.$meta.async.direct.deferred.promise,a.$getItemsPromises=function(){var b,c,d,e;for(e=[],c=0,d=a.length;d>c;c++)b=a[c],e.push(b.$promise);return e},a.$getItemsPromiseDirects=function(){var b,c,d,e;for(e=[],c=0,d=a.length;d>c;c++)b=a[c],e.push(b.$promiseDirect);return e},a.$_getPromiseForItems=function(){return b.all(a.$getItemsPromises())},a.$_getPromiseDirectForItems=function(){return b.all(a.$getItemsPromiseDirects())},a._resolvePromise=function(b,c){return null==c&&(c=!0),c?b.resolve(a):b.reject(a)},a.resolvePromise=function(b,d){return null==d&&(d=!0),a.$useApplyAsync?c.$applyAsync(function(){return a._resolvePromise(b,d)}):(a._resolvePromise(b,d),c.$$phase||c.$apply()),a},a.$finalize=function(b){var c;return null==b&&(b=!0),c=b,a.$_getPromiseForItems().then(function(){return a.resolvePromise(a.$meta.async.complete.deferred,b),a.$meta.async.complete.resolved=!0},function(){return c=!1,a.resolvePromise(a.$meta.async.complete.deferred,c),a.$meta.async.complete.resolved=!0,a.$error=!0}),a.resolvePromise(a.$meta.async.direct.deferred,b),a.$meta.async.direct.resolved=!0,a.$error=!(b&&c),a},a},d._MakeInstanceFromRemote=function(a){var b;return b=new this,b._setupPromises(),b._fromRemote(a),b},d._GetURLBase=function(){return j(this.urlPrefix,this.urlEndpoint)},d._BuildHeaders=function(a,b,c){var d,e;return null==a&&(a=null),null==b&&(b=null),null==c&&(c=null),null==this.headers?{}:angular.isFunction(this.headers)?this.headers.call(this,{klass:this,what:a,method:b,instance:c}):angular.isObject(this.headers)?(e=function(d){return function(e,f){var g,h,i;for(h in f)i=f[h],g=angular.isFunction(i)?i.call(d,{klass:d,what:a,method:b,instance:c}):i,null!==g&&(e[h]=g);return e}}(this),d={},"common"in this.headers||null!=a&&a in this.headers||null!=b&&b in this.headers?("common"in this.headers&&e(d,this.headers.common),null!=a&&a in this.headers&&e(d,this.headers[a]),null!=b&&b in this.headers&&e(d,this.headers[b])):e(d,this.headers),d):{}},d._PrepareRequest=function(a){return a.klass=this,null!=this.prepareRequest&&angular.isFunction(this.prepareRequest)?this.prepareRequest.call(this,a):a},d.prototype._prepareRequest=function(a){return a.instance=this,this.constructor._PrepareRequest(a)},d._TransformResponse=function(a,b,c){var d;return null==c&&(c=null),d=angular.extend({},a,{request:a,response:b,data:b.data}),d.klass=this,d.instance=c,d.data=d.response.data,d.status=d.response.status,d.headers=d.response.headers,d.config=d.response.config,d.statusText=d.response.statusText,null!=this.transformResponse&&angular.isFunction(this.transformResponse)?this.transformResponse.call(this,d):d},d.prototype._transformResponse=function(a,b){return this.constructor._TransformResponse(a,b,this)},d._PostResponse=function(a){return a.klass=this,null!=this.postResponse&&angular.isFunction(this.postResponse)?this.postResponse.call(this,a):a},d.prototype._postResponse=function(a){return a.instance=this,this.constructor._PostResponse(a)},d.prototype._buildHeaders=function(a,b){return null==a&&(a=null),null==b&&(b=null),this.constructor._BuildHeaders(a,b,this)},d.prototype._setupPromises=function(){var a;return a=!1,(this.$meta.async.direct.resolved||null==this.$meta.async.direct.deferred)&&(this.$meta.async.direct.deferred=b.defer(),this.$meta.async.direct.resolved=!1,a=!0,this.$promiseDirect=this.$meta.async.direct.deferred.promise.then(function(a){return function(){return a.$meta.async.direct.resolved=!0,a}}(this))),(this.$meta.async.m2o.resolved||null==this.$meta.async.m2o.deferred)&&(this.$meta.async.m2o.deferred=b.defer(),this.$meta.async.m2o.resolved=!1,a=!0,this.$meta.async.m2o.deferred.promise.then(function(a){return function(){return a.$meta.async.m2o.resolved=!0,a}}(this))),(this.$meta.async.m2m.resolved||null==this.$meta.async.m2m.deferred)&&(this.$meta.async.m2m.deferred=b.defer(),this.$meta.async.m2m.resolved=!1,a=!0,this.$meta.async.m2m.deferred.promise.then(function(a){return function(){return a.$meta.async.m2m.resolved=!0,a}}(this))),a&&(this.$promise=b.all([this.$meta.async.direct.deferred.promise,this.$meta.async.m2o.deferred.promise,this.$meta.async.m2m.deferred.promise]).then(function(a){return function(){return a.$meta.async.direct.resolved=!0,a.$meta.async.m2o.resolved=!0,a.$meta.async.m2m.resolved=!0,a}}(this))),this},d.prototype._getURLBase=function(){return j(this.constructor.urlPrefix,this.constructor.urlEndpoint)},d.prototype._fetchRelations=function(){return null!=this.$id&&(this._fetchReferences(),this._fetchM2M()),this},d.prototype._fetchReferences=function(){var a,c,d,e;c=function(a,b,c){var d,e,f;return d=b.name,d in a&&null!=a[d]&&g(a[d])?(f=a[d],e=b.model.Get(f),a[d]=e,c.push(e.$promise)):void 0},e=[];for(d in this.constructor.fields)a=this._getField(d),a.type===this.constructor.Reference&&c(this,a,e);return b.all(e).then(function(a){return function(){return a.resolvePromise(a.$meta.async.m2o.deferred)}}(this),function(a){return function(){return a.resolvePromise(a.$meta.async.m2o.deferred,!1)}}(this)),this},d.prototype._fetchM2M=function(){var a,c,d,e,f,g,h,i;d=function(a,b,c,d){var e,f,g,h,i,j,k,l;if(e=b.name,e in a&&null!=a[e]&&angular.isArray(a[e])){for(i=[],h=b.model._MakeCollection(),l=a[e],j=0,k=l.length;k>j;j++)g=l[j],f=b.model.Get(g),h.push(f),i.push(f.$promise);return a[e]=h,c.push(h.$promise),d.push(h)}return a[e]=[]},f=[],a=[];for(e in this.constructor.fields)c=this._getField(e),c.type===this.constructor.ManyToMany&&d(this,c,f,a);for(b.all(f).then(function(a){return function(){return a.resolvePromise(a.$meta.async.m2m.deferred)}}(this),function(a){return function(){return a.resolvePromise(a.$meta.async.m2m.deferred,!1)}}(this)),h=0,i=a.length;i>h;h++)g=a[h],g.$finalize();return this},d.prototype._fromRemote=function(a){return this._fromRemoteObject(a),this.$meta.persisted=!0,this.resolvePromise(this.$meta.async.direct.deferred),this._fetchRelations(),this},d.prototype._resolvePromise=function(a,b){return null==b&&(b=!0),b?a.resolve(this):a.reject(this)},d.prototype.resolvePromise=function(a,b){return null==b&&(b=!0),this.$useApplyAsync?c.$applyAsync(function(c){return function(){return c._resolvePromise(a,b)}}(this)):(this._resolvePromise(a,b),c.$$phase||c.$apply()),this},d.prototype._getFields=function(){var a,b,c,d;a={},d=this.constructor.defaults;for(b in d)c=d[b],a[b]={"default":c};return this.constructor.idField in a||(a[this.constructor.idField]={"default":null}),angular.extend(a,this.constructor.fields),a},d.prototype._getField=function(a){var b;return b={name:a,remote:a,type:null,model:null},a in this.constructor.fields?angular.extend(b,this.constructor.fields[a]||{}):b},d.prototype._toObject=function(){var a,b,c,e,f,g,h,i;c={};for(b in this)if(__hasProp.call(this,b)&&(f=this[b],"$id"!==b&&"$meta"!==b&&"constructor"!==b&&"__proto__"!==b&&(a=this._getField(b),c[b]=f,f)))if(a.type===this.constructor.Reference)(angular.isObject(f)||f instanceof d)&&(c[b]=null!=f.$id?f.$id:null);else if(a.type===this.constructor.ManyToMany){for(g=angular.isArray(f)?f:[f],e=[],h=0,i=g.length;i>h;h++)f=g[h],e.push(angular.isObject(f)||f instanceof d?null!=f.$id?f.$id:null:f);c[b]=e}return c},d.prototype._fromObject=function(a){var b,c,d,e;b=angular.extend({},this.constructor.defaults,a||{});for(d in b)e=b[d],"$id"!==d&&"$meta"!==d&&"constructor"!==d&&"__proto__"!==d&&(this[d]=e);for(d in this.constructor.fields)c=this._getField(d),"$id"!==d&&"$meta"!==d&&"constructor"!==d&&"__proto__"!==d&&!(d in b)&&"default"in c&&(this[d]=c["default"]);return this},d.prototype._toRemoteObject=function(){var a,b,c,e,f,g,h,i;c={};for(b in this)if(__hasProp.call(this,b)&&(f=this[b],"$id"!==b&&"$meta"!==b&&"constructor"!==b&&"__proto__"!==b&&(a=this._getField(b),c[a.remote]=f,f)))if(a.type===this.constructor.Reference)(angular.isObject(f)||f instanceof d)&&(c[a.remote]=null!=f.$id?f.$id:null);else if(a.type===this.constructor.ManyToMany){for(g=angular.isArray(f)?f:[f],e=[],h=0,i=g.length;i>h;h++)f=g[h],e.push(angular.isObject(f)||f instanceof d?null!=f.$id?f.$id:null:f);c[a.remote]=e}return c},d.prototype._fromRemoteObject=function(a){var b,c,d,e,g,h;if(f(this.constructor.fields)){b=angular.extend({},this.constructor.defaults,a||{});for(e in b)g=b[e],"$id"!==e&&"$meta"!==e&&"constructor"!==e&&"__proto__"!==e&&(this[e]=g)}else{b=angular.extend({},a||{}),d=this._getFields();for(e in d)c=this._getField(e),"$id"!==e&&"$meta"!==e&&"constructor"!==e&&"__proto__"!==e&&(c.remote in b?this[e]=b[c.remote]:"default"in c&&(this[e]=c["default"]));h=this.constructor.defaults;for(e in h)g=h[e],e in this||(this[e]=g)}return this.constructor.idField in b&&(this.$id=a[this.constructor.idField]),this},d}()}]);